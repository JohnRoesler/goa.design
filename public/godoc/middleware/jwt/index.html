<!DOCTYPE html>



<html class="not-ie" lang="en"> 
<head>

	
	<meta charset="utf-8">
	<title>goa :: Design-first API Generation</title>
	<meta name="description" content="Goa is a code generation framework built in Go that provides the developer with a clear and concise path to generate idiomatic API and Microservice architectures by using a design-first methodology.">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	
	<link href="/css/style.css" rel="stylesheet" type="text/css" />
	<link href="/css/font-awesome/font-awesome.min.css" rel="stylesheet" />
	
	
	
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800' rel='stylesheet' type='text/css' />

	
	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	<script>window.jQuery || document.write('<script src="/js/jquery-1.10.2.min.js"><\/script>')</script>
	
	
	

</head>

<body>

		
	<header id="header">
		
		<nav class="navbar">
			<div class="navbar-inner">
				<div class="container">
					
					<a class="brand" href="/">
						goa
					</a>
					<ul class="nav">
						<li><a href="/" title="Home">Home</a></li>
						<li><a href="/guide/" title="Getting Started">Getting Started</a></li>

						<li class="dropdown">
							<a href="/components/" title="components">Components</a>
							
							<ul>
								<li><a href="/components/goagen/" title="">goagen</a></li>
								<li><a href="/components/runtime/" title="">runtime</a></li>
								<li><a href="/components/swagger/" title="">swagger</a></li>
							</ul>
						</li>
						<li class="dropdown">
							<a href="/middleware/" title="middleware">Middleware</a>
							
							<ul>
								<li><a href="/middleware/jwt/" title="">JWT</a></li>
							</ul>
						</li>
						<li class="dropdown">
							<a href="/plugins/" title="plugins">Plugins</a>
							
							<ul>
								<li><a href="/plugins/gorma/" title="">gorma</a></li>
							</ul>
						</li>
						<li><a href="/tutorials/" title="Tutorials">Tutorials</a></li>
						<li><a href="/blog/" title="Blog">Blog</a></li>
						<li><a href="https://github.com/goadesign/goa" title="GitHub">GitHub</a></li>
					</ul>
				</div>
			</div>
		</nav>

	</header>
	
	
	<section id="content" class="container">

	<div class="hero-unit">
		<h1>middleware/jwt</h1>
		<p>godoc for middleware/jwt</p>
	</div>

	<hr />

	
	<div class="row" id="blog">

		
		<div class="span8"> 
			

<h1 id="jwt:ae11cf93ad8cc7f6c98c318fecc45c8d">jwt</h1>

<pre><code>import &quot;github.com/goadesign/middleware/jwt&quot;
</code></pre>

<p>Package jwt makes it possible to authorize API requests using JSON Web Tokens,
see <a href="https://jwt.io/introduction/">https://jwt.io/introduction/</a></p>

<h3 id="middleware:ae11cf93ad8cc7f6c98c318fecc45c8d">Middleware</h3>

<p>The package provides a middleware that can be mounted on controllers that require authentication.
The JWT middleware is instantiated using the package Middleware function. This function accepts
a specification that describes the various properties used by the JWT signature and validation
algorithms.</p>

<pre><code>spec := &amp;jwt.Specification{
    AllowParam:       false,      // Pass tokens in headers only
    AuthOptions:      false,      // Do not authorize OPTIONS requests
    TTLMinutes:       1440,       // Tokens are valid for 24 hours
    Issuer:           &quot;me.com&quot;,   // me.com issued the token
    KeySigningMethod: jwt.RSA256, // Use the RSA256 hashing algorithm to sign tokens
    SigningKeyFunc:   privateKey, // privateKey returns the key used to sign tokens
    ValidationFunc:   pubKey,     // pubKey returns the key used to validate tokens
}
authorizedController.Use(jwt.Middleware(spec))
</code></pre>

<h3 id="token-manager:ae11cf93ad8cc7f6c98c318fecc45c8d">Token Manager</h3>

<p>The package also exposes a token manager that creates the JWT tokens. The manager is instantiated
using the same specification used to create the middleware:</p>

<pre><code>var tm *jwt.TokenManager = jwt.NewTokenManager(spec)

func Login(ctx *goa.Context) error {
    // ...
    // Authorize request using ctx, initialize tenant id if necessary etc.
    // ...
    claims := map[string]interface{}{
        &quot;accountID&quot;: accountID,
    }
    token, err := tm.Create(claims)
    if err != nil {
        return err
    }
    return ctx.Respond(200, token) // You'll probably need something different here
}
</code></pre>

<h2 id="constants:ae11cf93ad8cc7f6c98c318fecc45c8d">Constants</h2>

<pre><code class="language-go">const JWTHeader = &quot;Authorization&quot;
</code></pre>

<p>JWTHeader is the name of the header used to transmit the JWT token.</p>

<pre><code class="language-go">const JWTKey middlewareKey = 0
</code></pre>

<p>JWTKey is the JWT middleware key used to store the token in the context.</p>

<pre><code class="language-go">const TokenManagerKey middlewareKey = 1
</code></pre>

<p>TokenManagerKey is the JWT middleware key used to store the token manager in the context.</p>

<h2 id="func-gettoken:ae11cf93ad8cc7f6c98c318fecc45c8d">func GetToken</h2>

<pre><code class="language-go">func GetToken(ctx *goa.Context, spec *Specification) (token *jwt.Token, err error)
</code></pre>

<p>GetToken extracts the JWT token from the request if there is one.</p>

<h2 id="func-middleware:ae11cf93ad8cc7f6c98c318fecc45c8d">func Middleware</h2>

<pre><code class="language-go">func Middleware(spec *Specification) goa.Middleware
</code></pre>

<p>Middleware is a middleware that retrieves a JWT token from the request if present and
injects it into the context.  It checks for the token in the HTTP Headers first, then the querystring if
the specification &ldquo;AllowParam&rdquo; is true.
Retrieve it using ctx.Value(JWTKey).</p>

<h2 id="type-keyfunc:ae11cf93ad8cc7f6c98c318fecc45c8d">type KeyFunc</h2>

<pre><code class="language-go">type KeyFunc func() (interface{}, error)
</code></pre>

<p>KeyFunc is a function that returns the key to sign a
token.  It should return a []byte (for all)
or a *rsa.PrivateKey or *ecdsa.PrivateKey</p>

<h2 id="type-signingmethod:ae11cf93ad8cc7f6c98c318fecc45c8d">type SigningMethod</h2>

<pre><code class="language-go">type SigningMethod int
</code></pre>

<p>SigningMethod is the enum that lists the supported token signature hashing algorithms.</p>

<pre><code class="language-go">const (

    // RSA256 signing algorithm
    RSA256 SigningMethod = iota + 1
    // RSA384 signing algorithm
    RSA384
    // RSA512 signing algorithm
    RSA512
    // HMAC256 signing algorithm
    HMAC256
    // HMAC384 signing algorithm
    HMAC384
    // HMAC512 signing algorithm
    HMAC512
    // ECDSA256 signing algorithm
    ECDSA256
    // ECDSA384 signing algorithm
    ECDSA384
    // ECDSA512 signing algorithm
    ECDSA512
)
</code></pre>

<h2 id="type-specification:ae11cf93ad8cc7f6c98c318fecc45c8d">type Specification</h2>

<pre><code class="language-go">type Specification struct {
    // TokenHeader is the HTTP header to search for the JWT Token
    // Defaults to &quot;Authorization&quot;
    TokenHeader string
    // TokenParam is the request parameter to parse for the JWT Token
    // Defaults to &quot;token&quot;
    TokenParam string
    // AllowParam is a flag that determines whether it is allowable
    // to parse tokens from the querystring
    // Defaults to false
    AllowParam bool
    // ValidationFunc is a function that returns the key to validate the JWT
    // Required, no default
    ValidationFunc ValidationKeyfunc
    // AuthOptions is a flag that determines whether a token is required on OPTIONS
    // requests
    AuthOptions bool
    // TTLMinutes is the TTL for tokens that are generated
    TTLMinutes int
    // RefreshTTLMinutes is the TTL for refresh tokens that are generated
    // and should generally be much longer than TTLMinutes
    RefreshTTLMinutes int
    // Issuer is the name of the issuer that will be inserted into the
    // generated token's claims
    Issuer string
    // KeySigningMethod determines the type of key that will be used to sign
    // Tokens.
    KeySigningMethod SigningMethod
    // SigningKeyFunc is a function that returns the key used to sign the token
    SigningKeyFunc KeyFunc
    // CommonClaims is a list of claims added to all tokens issued
    CommonClaims map[string]interface{}
}
</code></pre>

<p>Specification describes the JWT authorization properties.
It is used to both instantiate a middleware and a token manager.
The middleware uses the specification properties to authorize the incoming
request while the token manager uses it to create authorization tokens.</p>

<h2 id="type-tokenmanager:ae11cf93ad8cc7f6c98c318fecc45c8d">type TokenManager</h2>

<pre><code class="language-go">type TokenManager struct {
    // contains filtered or unexported fields
}
</code></pre>

<p>TokenManager provides for the creation of access and refresh JWT Tokens</p>

<h3 id="func-newtokenmanager:ae11cf93ad8cc7f6c98c318fecc45c8d">func NewTokenManager</h3>

<pre><code class="language-go">func NewTokenManager(spec *Specification) *TokenManager
</code></pre>

<p>NewTokenManager returns a TokenManager.  If TTLMinutes isn&rsquo;t specified
it will default to 5 minutes.  Use the same Specification as you use for
Middleware() to ensure your tokens are compatible.</p>

<h3 id="func-tokenmanager-create:ae11cf93ad8cc7f6c98c318fecc45c8d">func (*TokenManager) Create</h3>

<pre><code class="language-go">func (tm *TokenManager) Create(claims map[string]interface{}) (string, error)
</code></pre>

<p>Create makes a new token, adding the claims provided.  It returns
a token as a string.</p>

<h2 id="type-validationkeyfunc:ae11cf93ad8cc7f6c98c318fecc45c8d">type ValidationKeyfunc</h2>

<pre><code class="language-go">type ValidationKeyfunc func(*jwt.Token) (interface{}, error)
</code></pre>

<p>ValidationKeyfunc is a function that takes a token and returns the key to validate that
token, which allows it to use inforamtion from the key itself to choose the key
to return.</p>

<hr />

<p>Generated by <a href="http://godoc.org/github.com/davecheney/godoc2md">godoc2md</a></p>


		</div>

		
	
		<div class="sidebar span4">

			
			<div class="widget">
				<input id="search" type="search" class="animated" placeholder="Search" />
				 <ul id="results">
    			        </ul>
			</div>

			
			<div class="widget">
				<h4>All Categories</h4>
				<ul class="icons-ul list-style">
					
						<li><a href="/categories/dsl-engine/">dsl-engine</a></li>
					
						<li><a href="/categories/generation/">generation</a></li>
					
						<li><a href="/categories/godoc/">godoc</a></li>
					
						<li><a href="/categories/middleware/">middleware</a></li>
					
						<li><a href="/categories/runtime/">runtime</a></li>
					
						<li><a href="/categories/swagger/">swagger</a></li>
					

				</ul>
			</div>

			
			<div class="widget">
				<h4>All Tags</h4>
				<ul class="tags">
					
						<li><a href="/tags/apidsl/">apidsl</a></li>
					
						<li><a href="/tags/app/">app</a></li>
					
						<li><a href="/tags/auth/">auth</a></li>
					
						<li><a href="/tags/binc/">binc</a></li>
					
						<li><a href="/tags/cbor/">cbor</a></li>
					
						<li><a href="/tags/cellar-cli/">cellar-cli</a></li>
					
						<li><a href="/tags/client/">client</a></li>
					
						<li><a href="/tags/codegen/">codegen</a></li>
					
						<li><a href="/tags/cors/">cors</a></li>
					
						<li><a href="/tags/design/">design</a></li>
					
						<li><a href="/tags/dsl/">dsl</a></li>
					
						<li><a href="/tags/dslengine/">dslengine</a></li>
					
						<li><a href="/tags/example/">example</a></li>
					
						<li><a href="/tags/gen_app/">gen_app</a></li>
					
						<li><a href="/tags/gen_client/">gen_client</a></li>
					
						<li><a href="/tags/gen_gen/">gen_gen</a></li>
					
						<li><a href="/tags/gen_js/">gen_js</a></li>
					
						<li><a href="/tags/gen_main/">gen_main</a></li>
					
						<li><a href="/tags/gen_schema/">gen_schema</a></li>
					
						<li><a href="/tags/gen_swagger/">gen_swagger</a></li>
					
						<li><a href="/tags/genmodels/">genmodels</a></li>
					
						<li><a href="/tags/goa/">goa</a></li>
					
						<li><a href="/tags/goagen/">goagen</a></li>
					
						<li><a href="/tags/godoc/">godoc</a></li>
					
						<li><a href="/tags/gogoprotobuf/">gogoprotobuf</a></li>
					
						<li><a href="/tags/gorma/">gorma</a></li>
					
						<li><a href="/tags/gzip/">gzip</a></li>
					
						<li><a href="/tags/json/">json</a></li>
					
						<li><a href="/tags/jwt/">jwt</a></li>
					
						<li><a href="/tags/meta/">meta</a></li>
					
						<li><a href="/tags/middleware/">middleware</a></li>
					
						<li><a href="/tags/msgpack/">msgpack</a></li>
					
						<li><a href="/tags/swagger/">swagger</a></li>
					
						<li><a href="/tags/test/">test</a></li>
					
						<li><a href="/tags/utils/">utils</a></li>
					
				</ul>
			</div>

		</div>
		<script type="text/javascript" src="/js/lunr.min.js"></script>

    <script type="text/javascript">
    var lunrIndex,
        $results,
        pagesIndex;

    
    function initLunr() {
        
        $.getJSON("/js/pindex.json")
            .done(function(index) {
                pagesIndex = index;
                console.log("index:", pagesIndex);

                
                
                lunrIndex = lunr(function() {
                    this.field("title", {
                        boost: 10
                    });
                    this.field("tags", {
                        boost: 5
                    });
                    this.field("content");

                    
                    this.ref("href");
                });

                
                pagesIndex.forEach(function(page) {
                    lunrIndex.add(page);
                });
            })
            .fail(function(jqxhr, textStatus, error) {
                var err = textStatus + ", " + error;
                console.error("Error getting Hugo index flie:", err);
            });
    }

    
    function initUI() {
        $results = $("#results");
        $("#search").keyup(function() {
            $results.empty();

            
            var query = $(this).val();
            if (query.length < 2) {
                return;
            }

            var results = search(query);

            renderResults(results);
        });
    }

    

    function search(query) {
        
        
        
        
        
        return lunrIndex.search(query).map(function(result) {
                return pagesIndex.filter(function(page) {
                    return page.href === result.ref;
                })[0];
            });
    }

    

    function renderResults(results) {
        if (!results.length) {
            return;
        }

        
        results.slice(0, 10).forEach(function(result) {
            var $result = $("<li>");
            $result.append($("<a>", {
                href: result.href,
                text: "» " + result.title
            }));
            $results.append($result);
        });
    }

    
    initLunr();

    $(document).ready(function() {
        initUI();
    });
    </script>
	

	</div>
	</section>
		

	<footer id="footer">
		<div class="container">
			<div class="row">
				<div class="span4">
					<a class="brand" href="/">
						goa
					</a>
					<p>
						Elegant code generation<br />for your API or microservice. <br />
						Design First
						
					</p>
				</div>
				<div class="span4 social-networks">
					<h3>Find us elsewhere</h3>
					<p>
						<a class="social-network twitter" href="https://twitter.com/goadesign"></a>
					</p>
				</div>
				<div class="span4 newsletter">
					<h3>Developer List</h3>
					<a href="https://groups.google.com/forum/#!forum/goadesign">Join the Google Group</a>
				</div> 
			</div> 		
		</div> 
	</footer>

	<footer id="copyright">
		<div class="container">
			<div class="row">
				<div class="span8">
					&copy; 2015—2016 by <a>Raphael Simon and the goa contributors</a>
				</div>
			</div> 		
		</div> 
	</footer>

	

	<script type="text/javascript" src="/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="/js/jquery.isotope.min.js"></script>
	<script type="text/javascript" src="/js/jquery.touchSwipe.min.js"></script>
	<script type="text/javascript" src="/js/jquery.hotkeys.min.js" charset='utf-8'></script>
	<script type="text/javascript" src="/js/functions.min.js"></script>
	
</body>
</html>		

