<!DOCTYPE html>



<html class="not-ie" lang="en"> 
<head>

	
	<meta charset="utf-8">
	<title>goa :: Design-first API Generation</title>
	<meta name="description" content="Goa is a code generation framework built in Go that provides the developer with a clear and concise path to generate idiomatic API and Microservice architectures by using a design-first methodology.">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	
	<link href="/css/style.css" rel="stylesheet" type="text/css" />
	<link href="/css/font-awesome/font-awesome.min.css" rel="stylesheet" />
	
	
	
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800' rel='stylesheet' type='text/css' />

	
	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	<script>window.jQuery || document.write('<script src="/js/jquery-1.10.2.min.js"><\/script>')</script>
	
	
	

</head>

<body>

		
	<header id="header">
		
		<nav class="navbar">
			<div class="navbar-inner">
				<div class="container">
					
					<a class="brand" href="/">
						goa
					</a>
					<ul class="nav">
						<li><a href="/" title="Home">Home</a></li>
						<li><a href="/guide/" title="Getting Started">Getting Started</a></li>

						<li class="dropdown">
							<a href="/components/" title="components">Components</a>
							
							<ul>
								<li><a href="/components/goagen/" title="">goagen</a></li>
								<li><a href="/components/runtime/" title="">runtime</a></li>
								<li><a href="/components/swagger/" title="">swagger</a></li>
							</ul>
						</li>
						<li class="dropdown">
							<a href="/middleware/" title="middleware">Middleware</a>
							
							<ul>
								<li><a href="/middleware/jwt/" title="">JWT</a></li>
							</ul>
						</li>
						<li class="dropdown">
							<a href="/plugins/" title="plugins">Plugins</a>
							
							<ul>
								<li><a href="/plugins/gorma/" title="">gorma</a></li>
							</ul>
						</li>
						<li><a href="/tutorials/" title="Tutorials">Tutorials</a></li>
						<li><a href="/blog/" title="Blog">Blog</a></li>
						<li><a href="https://github.com/goadesign/goa" title="GitHub">GitHub</a></li>
					</ul>
				</div>
			</div>
		</nav>

	</header>
	
	
	<section id="content" class="container">

	<div class="hero-unit">
		<h1>middleware/cors</h1>
		<p>godoc for middleware/cors</p>
	</div>

	<hr />

	
	<div class="row" id="blog">

		
		<div class="span8"> 
			

<h1 id="cors:dcf9991619d3c40559795bfe4d699a98">cors</h1>

<pre><code>import &quot;github.com/goadesign/middleware/cors&quot;
</code></pre>

<p>Package cors provides a goa middleware that implements the Cross-Origin Resource Sharing (CORS)
standard as defined by W3C (<a href="http://www.w3.org/TR/access-control/">http://www.w3.org/TR/access-control/</a>). CORS implements a mechanism
to enable client-side cross-origin requests.</p>

<h3 id="middleware-dsl:dcf9991619d3c40559795bfe4d699a98">Middleware DSL</h3>

<p>This package implements a DSL that allows goa applications to define precisely all aspects of
CORS request handling. The DSL makes it possible to define the set of CORS resources exposed to
given origins. For each CORS resource it is possible to specify the allowed CORS request HTTP
methods and headers and all other CORS response properties. Additionnally CORS resources may be
equipped with a &ldquo;Check&rdquo; function which gets invoked by the middleware prior to handling a CORS
request. If this function returns false then the entire middleware is bypassed.</p>

<p>Here is an example of a CORS specification:</p>

<pre><code>New(func() {
    Origin(&quot;&lt;a href=&quot;https://goa.design&quot;&gt;https://goa.design&lt;/a&gt;&quot;, func () {     // This function defines CORS resources for the &lt;a href=&quot;https://goa.design&quot;&gt;https://goa.design&lt;/a&gt; origin.
        Resource(&quot;/private&quot;, func() {      // &quot;/private&quot; is the path of the CORS resource
            Headers(&quot;X-Shared-Secret&quot;) // One or more authorized headers
            Methods(&quot;GET&quot;, &quot;POST&quot;)     // One or more authorized HTTP methods
            Expose(&quot;X-Time&quot;)           // One or more headers exposed to clients
            MaxAge(600)                // How long to cache a prefligh request response
            Credentials(true)          // Sets Access-Control-Allow-Credentials header
            Vary(&quot;Http-Origin&quot;)        // Sets Vary header
            Check(func(ctx *Context) bool { // Optional function that causes the middleware to be bypassed when returning false.
                if ctx.Request.Header().Get(&quot;X-Client&quot;) == &quot;api&quot; {
                    return false
                }
                return true
            })
        })
    })
    // Origins can be defined using regular expression with OriginRegex:
    OrignRegex(regexp.MustCompile(&quot;^https?://([^\.]\.)?goa.design$&quot;), func () {
        Resource(&quot;/public/*&quot;, func() {
            Methods(&quot;GET&quot;)
        })
        // Each origin may expose any number of CORS resources.
        Resource(&quot;/public/actions/*&quot;, func() {
            Methods(&quot;GET&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;DELETE&quot;)
        })
    })
}}
</code></pre>

<h3 id="cors-middleware-and-the-vary-http-header:dcf9991619d3c40559795bfe4d699a98">CORS Middleware and the Vary HTTP Header</h3>

<p>The middleware automatically sets the &ldquo;Vary&rdquo; header to &ldquo;Origin&rdquo; unless the DSL defines a custom
value for it. The idea is to prevent caching of responses coming from different origins. Ideally
the application should make an effort at normalizing the value used in the  &ldquo;Vary&rdquo; header. See
<a href="https://www.fastly.com/blog/best-practices-for-using-the-vary-header">https://www.fastly.com/blog/best-practices-for-using-the-vary-header</a>.</p>

<h3 id="cors-usage-in-goa:dcf9991619d3c40559795bfe4d699a98">CORS Usage in goa</h3>

<p>A goa service wanting to leverage this package to add support for CORS requests needs to do two
things. First the service should mount the CORS middleware using for example:</p>

<pre><code>spec := cors.New(func() {
    // ... CORS DSL goes here
})
service.Use(cors.Middleware(spec))
</code></pre>

<p>Secondly the service should mount the preflight controller. This controller takes care of
handling CORS preflight requests. It should be mounted <em>last</em> to avoid collisions in the low
level router between the service OPTIONS handler and the preflight controller handlers.</p>

<pre><code>cors.MountPreflightController(service, spec)
</code></pre>

<h2 id="func-check:dcf9991619d3c40559795bfe4d699a98">func Check</h2>

<pre><code class="language-go">func Check(check CheckFunc)
</code></pre>

<p>Check sets a function that must return true if the request is to be treated as a valid CORS
request.</p>

<h2 id="func-credentials:dcf9991619d3c40559795bfe4d699a98">func Credentials</h2>

<pre><code class="language-go">func Credentials(val bool)
</code></pre>

<p>Credentials sets the Access-Control-Allow-Credentials response header.</p>

<h2 id="func-expose:dcf9991619d3c40559795bfe4d699a98">func Expose</h2>

<pre><code class="language-go">func Expose(headers ...string)
</code></pre>

<p>Expose defines the HTTP headers in the resource response that can be exposed to the client.</p>

<h2 id="func-headers:dcf9991619d3c40559795bfe4d699a98">func Headers</h2>

<pre><code class="language-go">func Headers(headers ...string)
</code></pre>

<p>Headers defines the HTTP headers that will be allowed in the CORS resource request.
Use &ldquo;*&rdquo; to allow for any headerResources in the actual request.</p>

<h2 id="func-maxage:dcf9991619d3c40559795bfe4d699a98">func MaxAge</h2>

<pre><code class="language-go">func MaxAge(age int)
</code></pre>

<p>MaxAge sets the Access-Control-Max-Age response header.</p>

<h2 id="func-methods:dcf9991619d3c40559795bfe4d699a98">func Methods</h2>

<pre><code class="language-go">func Methods(methods ...string)
</code></pre>

<p>Methods defines the HTTP methods allowed for the resource.</p>

<h2 id="func-middleware:dcf9991619d3c40559795bfe4d699a98">func Middleware</h2>

<pre><code class="language-go">func Middleware(spec Specification) goa.Middleware
</code></pre>

<p>Middleware returns a goa middleware which implements the given CORS specification.</p>

<h2 id="func-mountpreflightcontroller:dcf9991619d3c40559795bfe4d699a98">func MountPreflightController</h2>

<pre><code class="language-go">func MountPreflightController(service goa.Service, spec Specification)
</code></pre>

<p>MountPreflightController mounts the handlers for the CORS preflight requests onto service.</p>

<h2 id="func-origin:dcf9991619d3c40559795bfe4d699a98">func Origin</h2>

<pre><code class="language-go">func Origin(origin string, dsl func())
</code></pre>

<p>Origin defines a group of CORS resources for the given origin.</p>

<h2 id="func-originregex:dcf9991619d3c40559795bfe4d699a98">func OriginRegex</h2>

<pre><code class="language-go">func OriginRegex(origin *regexp.Regexp, dsl func())
</code></pre>

<p>OriginRegex defines a group of CORS resources for the origins matching the given regex.</p>

<h2 id="func-resource:dcf9991619d3c40559795bfe4d699a98">func Resource</h2>

<pre><code class="language-go">func Resource(path string, dsl func())
</code></pre>

<p>Resource defines a resource subject to CORS requests. The resource is defined using its URL
path. The path can finish with the &ldquo;*&rdquo; wildcard character to indicate that all path under the
given prefix target the resource.</p>

<h2 id="func-vary:dcf9991619d3c40559795bfe4d699a98">func Vary</h2>

<pre><code class="language-go">func Vary(headers ...string)
</code></pre>

<p>Vary is a list of HTTP headers to add to the &lsquo;Vary&rsquo; header.</p>

<h2 id="type-checkfunc:dcf9991619d3c40559795bfe4d699a98">type CheckFunc</h2>

<pre><code class="language-go">type CheckFunc func(*goa.Context) bool
</code></pre>

<p>CheckFunc is the signature of the user provided function invoked by the middleware to
check whether to handle CORS headers.</p>

<h2 id="type-resourcedefinition:dcf9991619d3c40559795bfe4d699a98">type ResourceDefinition</h2>

<pre><code class="language-go">type ResourceDefinition struct {
    // Origin defines the origin that may access the CORS resource.
    // One and only one of Origin or OriginRegexp must be set.
    Origin string

    // OriginRegexp defines the origins that may access the CORS resource.
    // One and only one of Origin or OriginRegexp must be set.
    OriginRegexp *regexp.Regexp

    // Path is the resource URL path.
    Path string

    // IsPathPrefix is true if Path is a path prefix, false if it's an exact match.
    IsPathPrefix bool

    // Headers contains the allowed CORS request headers.
    Headers []string

    // Methods contains the allowed CORS request methods.
    Methods []string

    // Expose contains the headers that should be exposed to clients.
    Expose []string

    // MaxAge defines the value of the Access-Control-Max-Age header CORS requeets
    // response header.
    MaxAge int

    // Credentials defines the value of the Access-Control-Allow-Credentials CORS
    // requests response header.
    Credentials bool

    // Vary defines the value of the Vary response header.
    // See https://www.fastly.com/blog/best-practices-for-using-the-vary-header.
    Vary []string

    // Check is an optional user provided functions that causes CORS handling to be
    // bypassed when it return false.
    Check CheckFunc
}
</code></pre>

<p>ResourceDefinition represents a CORS resource as defined by its path (or path prefix).</p>

<h3 id="func-resourcedefinition-fillheaders:dcf9991619d3c40559795bfe4d699a98">func (*ResourceDefinition) FillHeaders</h3>

<pre><code class="language-go">func (res *ResourceDefinition) FillHeaders(origin string, header http.Header)
</code></pre>

<p>FillHeaders initializes the given header with the resource CORS headers. origin is the request
origin.</p>

<h3 id="func-resourcedefinition-originallowed:dcf9991619d3c40559795bfe4d699a98">func (*ResourceDefinition) OriginAllowed</h3>

<pre><code class="language-go">func (res *ResourceDefinition) OriginAllowed(origin string) bool
</code></pre>

<p>OriginAllowed returns true if the resource is accessible to the given origin.</p>

<h3 id="func-resourcedefinition-pathmatches:dcf9991619d3c40559795bfe4d699a98">func (*ResourceDefinition) PathMatches</h3>

<pre><code class="language-go">func (res *ResourceDefinition) PathMatches(path string) bool
</code></pre>

<p>PathMatches returns true if the resource lives under the given path.</p>

<h2 id="type-specification:dcf9991619d3c40559795bfe4d699a98">type Specification</h2>

<pre><code class="language-go">type Specification []*ResourceDefinition
</code></pre>

<p>Specification contains the information needed to handle CORS requests.</p>

<h3 id="func-new:dcf9991619d3c40559795bfe4d699a98">func New</h3>

<pre><code class="language-go">func New(dsl func()) (Specification, error)
</code></pre>

<p>New runs the given CORS specification DSL and returns the built-up data structure.</p>

<h3 id="func-specification-pathresource:dcf9991619d3c40559795bfe4d699a98">func (Specification) PathResource</h3>

<pre><code class="language-go">func (v Specification) PathResource(path string) *ResourceDefinition
</code></pre>

<p>PathResource returns the resource under the given path if any.</p>

<h3 id="func-specification-requestresource:dcf9991619d3c40559795bfe4d699a98">func (Specification) RequestResource</h3>

<pre><code class="language-go">func (v Specification) RequestResource(ctx *goa.Context, origin string) *ResourceDefinition
</code></pre>

<p>RequestResource returns the resource targeted by the CORS request defined in ctx.</p>

<h3 id="func-specification-string:dcf9991619d3c40559795bfe4d699a98">func (Specification) String</h3>

<pre><code class="language-go">func (v Specification) String() string
</code></pre>

<p>String returns a human friendly representation of the CORS specification.</p>

<hr />

<p>Generated by <a href="http://godoc.org/github.com/davecheney/godoc2md">godoc2md</a></p>


		</div>

		
	
		<div class="sidebar span4">

			
			<div class="widget">
				<input id="search" type="search" class="animated" placeholder="Search" />
				 <ul id="results">
    			        </ul>
			</div>

			
			<div class="widget">
				<h4>All Categories</h4>
				<ul class="icons-ul list-style">
					
						<li><a href="/categories/dsl-engine/">dsl-engine</a></li>
					
						<li><a href="/categories/generation/">generation</a></li>
					
						<li><a href="/categories/godoc/">godoc</a></li>
					
						<li><a href="/categories/middleware/">middleware</a></li>
					
						<li><a href="/categories/runtime/">runtime</a></li>
					
						<li><a href="/categories/swagger/">swagger</a></li>
					

				</ul>
			</div>

			
			<div class="widget">
				<h4>All Tags</h4>
				<ul class="tags">
					
						<li><a href="/tags/apidsl/">apidsl</a></li>
					
						<li><a href="/tags/app/">app</a></li>
					
						<li><a href="/tags/auth/">auth</a></li>
					
						<li><a href="/tags/binc/">binc</a></li>
					
						<li><a href="/tags/cbor/">cbor</a></li>
					
						<li><a href="/tags/cellar-cli/">cellar-cli</a></li>
					
						<li><a href="/tags/client/">client</a></li>
					
						<li><a href="/tags/codegen/">codegen</a></li>
					
						<li><a href="/tags/cors/">cors</a></li>
					
						<li><a href="/tags/design/">design</a></li>
					
						<li><a href="/tags/dsl/">dsl</a></li>
					
						<li><a href="/tags/dslengine/">dslengine</a></li>
					
						<li><a href="/tags/example/">example</a></li>
					
						<li><a href="/tags/gen_app/">gen_app</a></li>
					
						<li><a href="/tags/gen_client/">gen_client</a></li>
					
						<li><a href="/tags/gen_gen/">gen_gen</a></li>
					
						<li><a href="/tags/gen_js/">gen_js</a></li>
					
						<li><a href="/tags/gen_main/">gen_main</a></li>
					
						<li><a href="/tags/gen_schema/">gen_schema</a></li>
					
						<li><a href="/tags/gen_swagger/">gen_swagger</a></li>
					
						<li><a href="/tags/genmodels/">genmodels</a></li>
					
						<li><a href="/tags/goa/">goa</a></li>
					
						<li><a href="/tags/goagen/">goagen</a></li>
					
						<li><a href="/tags/godoc/">godoc</a></li>
					
						<li><a href="/tags/gogoprotobuf/">gogoprotobuf</a></li>
					
						<li><a href="/tags/gorma/">gorma</a></li>
					
						<li><a href="/tags/gzip/">gzip</a></li>
					
						<li><a href="/tags/json/">json</a></li>
					
						<li><a href="/tags/jwt/">jwt</a></li>
					
						<li><a href="/tags/meta/">meta</a></li>
					
						<li><a href="/tags/middleware/">middleware</a></li>
					
						<li><a href="/tags/msgpack/">msgpack</a></li>
					
						<li><a href="/tags/swagger/">swagger</a></li>
					
						<li><a href="/tags/test/">test</a></li>
					
						<li><a href="/tags/utils/">utils</a></li>
					
				</ul>
			</div>

		</div>
		<script type="text/javascript" src="/js/lunr.min.js"></script>

    <script type="text/javascript">
    var lunrIndex,
        $results,
        pagesIndex;

    
    function initLunr() {
        
        $.getJSON("/js/pindex.json")
            .done(function(index) {
                pagesIndex = index;
                console.log("index:", pagesIndex);

                
                
                lunrIndex = lunr(function() {
                    this.field("title", {
                        boost: 10
                    });
                    this.field("tags", {
                        boost: 5
                    });
                    this.field("content");

                    
                    this.ref("href");
                });

                
                pagesIndex.forEach(function(page) {
                    lunrIndex.add(page);
                });
            })
            .fail(function(jqxhr, textStatus, error) {
                var err = textStatus + ", " + error;
                console.error("Error getting Hugo index flie:", err);
            });
    }

    
    function initUI() {
        $results = $("#results");
        $("#search").keyup(function() {
            $results.empty();

            
            var query = $(this).val();
            if (query.length < 2) {
                return;
            }

            var results = search(query);

            renderResults(results);
        });
    }

    

    function search(query) {
        
        
        
        
        
        return lunrIndex.search(query).map(function(result) {
                return pagesIndex.filter(function(page) {
                    return page.href === result.ref;
                })[0];
            });
    }

    

    function renderResults(results) {
        if (!results.length) {
            return;
        }

        
        results.slice(0, 10).forEach(function(result) {
            var $result = $("<li>");
            $result.append($("<a>", {
                href: result.href,
                text: "» " + result.title
            }));
            $results.append($result);
        });
    }

    
    initLunr();

    $(document).ready(function() {
        initUI();
    });
    </script>
	

	</div>
	</section>
		

	<footer id="footer">
		<div class="container">
			<div class="row">
				<div class="span4">
					<a class="brand" href="/">
						goa
					</a>
					<p>
						Elegant code generation<br />for your API or microservice. <br />
						Design First
						
					</p>
				</div>
				<div class="span4 social-networks">
					<h3>Find us elsewhere</h3>
					<p>
						<a class="social-network twitter" href="https://twitter.com/goadesign"></a>
					</p>
				</div>
				<div class="span4 newsletter">
					<h3>Developer List</h3>
					<a href="https://groups.google.com/forum/#!forum/goadesign">Join the Google Group</a>
				</div> 
			</div> 		
		</div> 
	</footer>

	<footer id="copyright">
		<div class="container">
			<div class="row">
				<div class="span8">
					&copy; 2015—2016 by <a>Raphael Simon and the goa contributors</a>
				</div>
			</div> 		
		</div> 
	</footer>

	

	<script type="text/javascript" src="/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="/js/jquery.isotope.min.js"></script>
	<script type="text/javascript" src="/js/jquery.touchSwipe.min.js"></script>
	<script type="text/javascript" src="/js/jquery.hotkeys.min.js" charset='utf-8'></script>
	<script type="text/javascript" src="/js/functions.min.js"></script>
	
</body>
</html>		

