+++
title = "Getting Started"
weight = 2

[menu.main]
name = "Getting Started"
parent = "learn"
+++

This guide walks you through writing a complete service in goa.
The simple service implements the basic example found in the
[github repository](https://github.com/goadesign/goa/tree/v2/examples/basic).

## Prerequisites

Install `goa`

```
go get -u goa.design/goa/...
```

## Design

Describe the service using the goa DSLs. Create a new directory under
`$GOPATH/src` for the new goa service (e.g. `$GOPATH/src/basic`). In the root
of the newly created directory create a sub-directory called `design` (or any
other name, `design` is just a convention) with a Go file containing

```go
package design

import (
	. "goa.design/goa/dsl"
)

var _ = API("calc", func() {
	Title("Calculator Service")
	Description("Service for adding numbers, a goa teaser")
})

var _ = Service("calc", func() {
	Description("The calc service performs operations on numbers")

	Method("add", func() {
		Payload(func() {
			Attribute("a", Int, "Left operand", func() {
				Meta("rpc:tag", "1")
			})
			Field(2, "b", Int, "Right operand")
			Required("a", "b")
		})

		Result(Int)

		HTTP(func() {
			GET("/add/{a}/{b}")
			Response(StatusOK)
		})

		GRPC(func() {
			Response(CodeOK)
		})
	})

	Files("/swagger.json", "../../gen/http/openapi.json")
})
```

The above design describes a service named `calc` containing a single method
`add` which takes a payload as input and returns an integer containing the sum.
The `add` method describes `HTTP` and `GRPC` DSLs which generates code for the
HTTP and gRPC transports respectively.

The design also exposes a HTTP file server endpoint which serves the goa
generated Open API specification.

The above example only covers a fraction of what goa can do. More examples can
be found in the [goa repository](https://github.com/goadesign/goa/blob/v2/examples).
The [goa DSL package](https://godoc.org/goa.design/goa/dsl) lists all the DSL
keywords together with a description and example usage.

## Code Generation

### `goa gen` Command

Once we have a design for our service, run the `goa gen` command to generate
the boilerplate code. The command takes the design package as an argument.
Optionally, it also takes the target directory as an argument to house the
generated code. Since the design package is created under `$GOPATH/src/basic`,
the command line is:

```
$ goa gen basic/design -o $GOPATH/src/basic
```

The command outputs the names of the files it generates. If the target
directory is not specified, the command generates the files in the current
working directory. The generated files should look like this:

```
├── design
│   └── design.go
└── gen
    ├── calc
    │   ├── client.go
    │   ├── endpoints.go
    │   └── service.go
    ├── grpc
    │   ├── calc
    │   │   ├── client
    │   │   │   ├── client.go
    │   │   │   ├── cli.go
    │   │   │   ├── encode_decode.go
    │   │   │   └── types.go
    │   │   ├── pb
    │   │   │   ├── calc.pb.go
    │   │   │   └── calc.proto
    │   │   └── server
    │   │       ├── encode_decode.go
    │   │       ├── server.go
    │   │       └── types.go
    │   └── cli
    │       └── calc
    │           └── cli.go
    └── http
        ├── calc
        │   ├── client
        │   │   ├── client.go
        │   │   ├── cli.go
        │   │   ├── encode_decode.go
        │   │   ├── paths.go
        │   │   └── types.go
        │   └── server
        │       ├── encode_decode.go
        │       ├── paths.go
        │       ├── server.go
        │       └── types.go
        ├── cli
        │   └── calc
        │       └── cli.go
        ├── openapi.json
        └── openapi.yaml
```

The `gen` directory contains the `calc` sub-directory which contains the
transport-independent service code. The `endpoints.go` file creates a
[goa endpoint](https://godoc.org/goa.design/goa#Endpoint) which exposes
the transport-agnostic service code to the transport layers.

The `grpc` sub-directory contains protocol buffer file (`pb/calc.proto`)
describing the `calc` gRPC service and the [protoc compiled protocol buffer Go
file](https://developers.google.com/protocol-buffers/docs/proto3#generating)
(`pb/calc.pb.go`). It also contains the server and client code which hooks up
the protoc-generated gRPC server and client code along with the logic to
encode and decode requests and responses and the CLI code to build gRPC
requests from the command line.

The `http` sub-directory describes the HTTP transport which defines server and
client code with the logic to encode and decode requests and responses and the
CLI code to build HTTP requests from the command line. It also contains the
Open API 2.0 specification files in both json and yaml formats.

We **MUST NOT** edit the code generated by `goa gen` command.

### `goa example` Command

We can then run the `goa example` command to generate a basic implementation of
the service along with buildable server files that spins up goroutines to start
a HTTP and a gRPC server and client files that can make requests to the server.

```
$ goa example basic/design -o $GOPATH/src/basic
```

The `goa example` command creates the following files

```

├── calc.go
├── cmd
│   ├── calc
│   │   ├── grpc.go
│   │   ├── http.go
│   │   └── main.go
│   └── calc-cli
│       ├── grpc.go
│       ├── http.go
│       └── main.go
├── design
└── gen
```

`calc.go` contains a dummy implementation of the `add` method described in the
design. The only thing left for us to do is to provide the actual
implementation, build, and run the server and client.

```
func (s *calcSvc) Add(ctx context.Context, p *calcsvc.AddPayload) (int, error) {
  return p.A + p.B, nil
}
```

The `goa example` command uses the optional [Server DSL](https://godoc.org/goa.design/goa/dsl#Server)
described in the design to generate buildable server and client files.
It builds one directory in `cmd` for each `Server` DSL specified in the
design. If a `Server` DSL is not specified in the design, goa creates a default
server exposing the `calc` service in a single host listening on "localhost"
and using port 80 for HTTP endpoints and port 8080 for gRPC endpoints.

## Building and Running the Service

The generated server and client code can be built and run as follows:

```
$ go build ./cmd/calc && go build ./cmd/calc-cli

# Run the server

$ ./calc
[calc] 12:27:57 HTTP "Add" mounted on GET /add/{a}/{b}
[calc] 12:27:57 HTTP "../../gen/http/openapi.json" mounted on GET /swagger.json
[calc] 12:27:57 serving gRPC method calc.Calc/Add
[calc] 12:27:57 HTTP server listening on "localhost:8000"
[calc] 12:27:57 gRPC server listening on "localhost:8080"

# Run the client

# Contact HTTP server
$ ./calc-cli --url="http://localhost:8000" calc add --a 1 --b 2
3

# Contact gRPC server
$ ./calc-cli --url="grpc://localhost:8080" calc add --message '{"a": 1, "b": 2}'
3
```

* `-h/--help` provides more information on using the server and client
executables.
